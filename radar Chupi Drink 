<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHUPIDRINK RADAR</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Firebase (add your config; mock for demo) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore.js"></script>
    <script src="app.js" defer></script>
</head>
<body>
    <div id="ritual" class="ritual-screen hidden">
        <div class="pulse-animation"></div>
        <h1>RADAR ATIVADO</h1>
        <p>Você agora vê o que nem todo mundo vê.</p>
        <button id="enter-btn">Entrar</button>
    </div>
    <div id="app" class="app-container hidden">
        <header id="header">CHUPIDRINK RADAR | <span id="status">Observador</span></header>
        <div id="signal-banner" class="hidden">Novo sinal detectado hoje.</div>
        <div id="main-content">
            <!-- Map -->
            <div id="map-view" class="view">
                <div id="map"></div>
            </div>
            <!-- Club -->
            <div id="club-view" class="view hidden">
                <h2>Clube Chupidrink</h2>
                <p>Acesso limitado.</p>
                <p>Para quem quer vender, hospedar ou distribuir.</p>
                <p>Early access.</p>
                <a href="https://wa.me/1234567890?text=Quero%20entrar%20no%20Clube%20Chupidrink" class="whatsapp-btn">Entrar em contato</a>
            </div>
            <!-- About -->
            <div id="about-view" class="view hidden">
                <h2>O Que É Chupidrink</h2>
                <p>Um drink alcoólico no formato chup-chup.</p>
                <p>Diferente porque é real, urbano, limitado.</p>
                <p>Não está em todo lugar. Por isso você procura.</p>
                <!-- SVG tube illustrations -->
                <svg class="tube-icon" viewBox="0 0 100 200"><!-- Placeholder SVG for chup-chup tube --></svg>
            </div>
        </div>
        <nav class="bottom-nav">
            <button id="map-btn" class="active">Encontrar Chupi</button>
            <button id="club-btn">Entrar no Clube</button>
            <button id="about-btn">O Que É Chupidrink</button>
        </nav>
        <div id="location-modal" class="modal hidden">
            <div class="modal-content">
                <span id="close-modal">&times;</span>
                <h3 id="loc-name"></h3>
                <p id="loc-type"></p>
                <p id="loc-distance"></p>
                <p id="loc-last"></p>
                <p id="loc-vibe"></p>
            </div>
        </div>
    </div>
</body>
</html>

body { background: #121212; color: #fff; font-family: sans-serif; margin: 0; overflow: hidden; }
.hidden { display: none; }
.ritual-screen { text-align: center; padding: 20vh 0; }
.pulse-animation { width: 100px; height: 100px; border-radius: 50%; background: #00FF00; animation: pulse 2s infinite; margin: 0 auto; }
@keyframes pulse { 0% { transform: scale(1); opacity: 0.5; } 50% { transform: scale(1.5); opacity: 0.2; } 100% { transform: scale(1); opacity: 0.5; } }
button { background: #00FF00; color: #000; border: none; padding: 10px; cursor: pointer; }
.app-container { height: 100vh; display: flex; flex-direction: column; }
header { background: #000; padding: 10px; text-align: center; font-family: 'Press Start 2P', cursive; }
#status { color: #00FF00; }
#signal-banner { background: #FF4500; padding: 5px; text-align: center; }
#main-content { flex: 1; }
.view { height: 100%; }
#map { height: 100%; }
.bottom-nav { display: flex; justify-content: space-around; background: #000; padding: 10px; }
.bottom-nav button.active { background: #FFD700; }
.modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; }
.modal-content { background: #121212; padding: 20px; border-radius: 10px; width: 80%; }
#close-modal { float: right; cursor: pointer; }
.tube-icon { fill: #FFD700; width: 50px; height: 100px; } /* Add real SVG path for tube */
.whatsapp-btn { background: #25D366; color: #fff; padding: 10px; text-decoration: none; display: block; text-align: center; }

document.addEventListener('DOMContentLoaded', () => {
    const ritual = document.getElementById('ritual');
    const app = document.getElementById('app');
    const enterBtn = document.getElementById('enter-btn');
    const statusSpan = document.getElementById('status');
    const signalBanner = document.getElementById('signal-banner');
    const mapView = document.getElementById('map-view');
    const clubView = document.getElementById('club-view');
    const aboutView = document.getElementById('about-view');
    const mapBtn = document.getElementById('map-btn');
    const clubBtn = document.getElementById('club-btn');
    const aboutBtn = document.getElementById('about-btn');
    const modal = document.getElementById('location-modal');
    const closeModal = document.getElementById('close-modal');

    // Mock locations (replace with Firebase fetch)
    const locations = [
        { id: 1, lat: -23.5505, lng: -46.6333, name: 'Rua das Sombras', type: 'Street', last: 'Há 2 horas', vibe: 'Hoje, enquanto durar.', color: '#FF4500' },
        // Add more...
    ];

    // User status
    let viewedCount = parseInt(localStorage.getItem('viewedCount')) || 0;
    let status = 'Observador';
    if (viewedCount >= 3) status = 'Explorador';
    if (viewedCount >= 10) status = 'Dentro';
    statusSpan.textContent = status;

    // Signals system
    if (Math.random() < 0.1) signalBanner.classList.remove('hidden');

    // Ritual
    if (!localStorage.getItem('ritualDone')) {
        ritual.classList.remove('hidden');
        enterBtn.addEventListener('click', enterApp);
        setTimeout(enterApp, 5000);
    } else {
        app.classList.remove('hidden');
        initMap();
    }

    function enterApp() {
        localStorage.setItem('ritualDone', 'true');
        ritual.classList.add('hidden');
        app.classList.remove('hidden');
        initMap();
    }

    // Map init
    let map;
    function initMap() {
        if (!map) {
            map = L.map('map').setView([-23.5505, -46.6333], 13); // Default São Paulo
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            navigator.geolocation.getCurrentPosition(pos => {
                map.setView([pos.coords.latitude, pos.coords.longitude], 15);
                L.marker([pos.coords.latitude, pos.coords.longitude]).addTo(map).bindPopup('Você');
            });
            locations.forEach(loc => {
                const marker = L.marker([loc.lat, loc.lng], { icon: L.divIcon({ className: 'neon-marker', html: `<div style="background:${loc.color};width:20px;height:40px;border-radius:10px;"></div>` }) });
                marker.addTo(map);
                marker.on('click', () => showLocation(loc));
            });
        }
    }

    function showLocation(loc) {
        document.getElementById('loc-name').textContent = loc.name;
        document.getElementById('loc-type').textContent = `Type: ${loc.type}`;
        document.getElementById('loc-distance').textContent = `Distance: Calculando...`; // Add real calc if geo avail
        document.getElementById('loc-last').textContent = loc.last;
        document.getElementById('loc-vibe').textContent = loc.vibe;
        modal.classList.remove('hidden');
        viewedCount++;
        localStorage.setItem('viewedCount', viewedCount);
        // Update status logic here
    }

    closeModal.addEventListener('click', () => modal.classList.add('hidden'));

    // Nav
    function switchView(view) {
        mapView.classList.add('hidden');
        clubView.classList.add('hidden');
        aboutView.classList.add('hidden');
        mapBtn.classList.remove('active');
        clubBtn.classList.remove('active');
        aboutBtn.classList.remove('active');
        if (view === 'map') { mapView.classList.remove('hidden'); mapBtn.classList.add('active'); initMap(); }
        if (view === 'club') { clubView.classList.remove('hidden'); clubBtn.classList.add('active'); }
        if (view === 'about') { aboutView.classList.remove('hidden'); aboutBtn.classList.add('active'); }
    }

    mapBtn.addEventListener('click', () => switchView('map'));
    clubBtn.addEventListener('click', () => switchView('club'));
    aboutBtn.addEventListener('click', () => switchView('about'));
});

// Firebase mock/init (replace with real)
const firebaseConfig = { /* Your config */ };
// firebase.initializeApp(firebaseConfig);
// const db = firebase.firestore();
// Fetch locations from db.collection('points').get()...

// Service worker register
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js');
}

const CACHE_NAME = 'chupidrink-radar-v1';
const urlsToCache = ['/', '/index.html', '/styles.css', '/app.js', 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js', 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css'];

self.addEventListener('install', event => {
    event.waitUntil(caches.open(CACHE_NAME).then(cache => cache.addAll(urlsToCache)));
});

self.addEventListener('fetch', event => {
    event.respondWith(caches.match(event.request).then(response => response || fetch(event.request)));
});

{
    "name": "CHUPIDRINK RADAR",
    "short_name": "ChupiRadar",
    "start_url": "/",
    "display": "standalone",
    "background_color": "#121212",
    "theme_color": "#00FF00",
    "icons": [
        {"src": "icons/icon-192.png", "sizes": "192x192", "type": "image/png"},
        {"src": "icons/icon-512.png", "sizes": "512x512", "type": "image/png"}
    ]
}

